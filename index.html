<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–∑—É—á–µ–Ω–∏–µ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Source+Sans+3:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #f5f3ed;
            --bg-card: #ffffff;
            --text-primary: #2c2416;
            --text-secondary: #6b6458;
            --accent-new: #d94e4e;
            --accent-learning: #e8b34f;
            --accent-learned: #5a9d6b;
            --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans 3', sans-serif;
            background: linear-gradient(135deg, #f5f3ed 0%, #ebe8dd 100%);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 1rem;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1rem;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }

        .subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .progress-bar {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-soft);
        }

        .progress-stats {
            display: flex;
            gap: 1rem;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat {
            flex: 1;
            text-align: center;
            padding: 1rem;
            border-radius: 12px;
            transition: transform 0.3s ease;
        }

        .stat:hover {
            transform: translateY(-2px);
        }

        .stat.new {
            background: linear-gradient(135deg, var(--accent-new) 0%, #c43e3e 100%);
            color: white;
        }

        .stat.learning {
            background: linear-gradient(135deg, var(--accent-learning) 0%, #d9a03f 100%);
            color: white;
        }

        .stat.learned {
            background: linear-gradient(135deg, var(--accent-learned) 0%, #4a8559 100%);
            color: white;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'Cormorant Garamond', serif;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.95;
            margin-top: 0.25rem;
        }

        .current-group {
            text-align: center;
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-top: 1rem;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 8px;
        }

        .card-container {
            perspective: 1000px;
            margin-bottom: 2rem;
            min-height: 400px;
        }

        .card {
            position: relative;
            width: 100%;
            height: 400px;
            transform-style: preserve-3d;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            padding: 3rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: var(--bg-card);
            box-shadow: var(--shadow-card);
        }

        .card-front {
            background: linear-gradient(135deg, #ffffff 0%, #f9f8f6 100%);
        }

        .card-back {
            transform: rotateY(180deg);
            background: linear-gradient(135deg, #f9f8f6 0%, #ffffff 100%);
        }

        .card-suffix {
            font-family: 'Cormorant Garamond', serif;
            font-size: 4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            letter-spacing: 0.05em;
        }

        .card-type {
            font-size: 1.1rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        .card-rule {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            line-height: 1.7;
        }

        .card-exceptions {
            padding: 1rem 1.5rem;
            background: rgba(217, 78, 78, 0.08);
            border-radius: 12px;
            border-left: 4px solid var(--accent-new);
            font-size: 1rem;
            color: var(--text-primary);
        }

        .card-exceptions strong {
            color: var(--accent-new);
            font-weight: 600;
        }

        .flip-hint {
            position: absolute;
            bottom: 1.5rem;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9rem;
            color: var(--text-secondary);
            opacity: 0.7;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .btn {
            flex: 1;
            max-width: 250px;
            padding: 1.25rem 2rem;
            border: none;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Source Sans 3', sans-serif;
            box-shadow: var(--shadow-soft);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.5s, height 0.5s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:active {
            transform: scale(0.97);
        }

        .btn-wrong {
            background: linear-gradient(135deg, var(--accent-new) 0%, #c43e3e 100%);
            color: white;
        }

        .btn-wrong:hover {
            box-shadow: 0 8px 24px rgba(217, 78, 78, 0.3);
            transform: translateY(-2px);
        }

        .btn-correct {
            background: linear-gradient(135deg, var(--accent-learned) 0%, #4a8559 100%);
            color: white;
        }

        .btn-correct:hover {
            box-shadow: 0 8px 24px rgba(90, 157, 107, 0.3);
            transform: translateY(-2px);
        }

        .btn-reset {
            background: linear-gradient(135deg, #6b6458 0%, #5a5449 100%);
            color: white;
            max-width: 200px;
        }

        .btn-reset:hover {
            box-shadow: 0 8px 24px rgba(107, 100, 88, 0.3);
            transform: translateY(-2px);
        }

        .completion-screen {
            text-align: center;
            padding: 3rem;
            background: var(--bg-card);
            border-radius: 20px;
            box-shadow: var(--shadow-card);
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .completion-screen h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--accent-learned);
        }

        .completion-screen p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }

        .keyboard-hints {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 12px;
        }

        .keyboard-hints kbd {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background: var(--bg-card);
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin: 0 0.25rem;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 2rem;
            }

            .card {
                height: 450px;
            }

            .card-face {
                padding: 2rem;
            }

            .card-suffix {
                font-size: 3rem;
            }

            .controls {
                flex-direction: column;
            }

            .btn {
                max-width: none;
            }

            .progress-stats {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>–ò–∑—É—á–µ–Ω–∏–µ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤</h1>
        <p class="subtitle">–°–∏—Å—Ç–µ–º–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</p>

        <div class="progress-bar">
            <div class="progress-stats">
                <div class="stat new">
                    <div class="stat-number" id="newCount">0</div>
                    <div class="stat-label">–ù–µ–∏–∑—É—á–µ–Ω–Ω—ã–µ</div>
                </div>
                <div class="stat learning">
                    <div class="stat-number" id="learningCount">0</div>
                    <div class="stat-label">–ò–∑—É—á–∞—é—Ç—Å—è</div>
                </div>
                <div class="stat learned">
                    <div class="stat-number" id="learnedCount">0</div>
                    <div class="stat-label">–ò–∑—É—á–µ–Ω—ã</div>
                </div>
            </div>
            <div class="current-group" id="currentGroup"></div>
        </div>

        <div id="cardArea"></div>

        <div class="keyboard-hints">
            <kbd>–ü—Ä–æ–±–µ–ª</kbd> ‚Äî –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É ¬∑ 
            <kbd>‚Üê</kbd> ‚Äî –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ¬∑ 
            <kbd>‚Üí</kbd> ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω–æ ¬∑ 
            <kbd>R</kbd> ‚Äî —Å–±—Ä–æ—Å
        </div>
    </div>

    <script>
        const rulesData = [
            // –ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ
            { suffix: "-–ò–í-, -–ï–í-", type: "–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ", rule: "–ü–æ–¥ —É–¥–∞—Ä–µ–Ω–∏–µ–º –ø–∏—à–µ—Ç—Å—è -–ò–í-. –ë–µ–∑ —É–¥–∞—Ä–µ–Ω–∏—è –ø–∏—à–µ—Ç—Å—è -–ï–í-.", exceptions: "–ú–ò–õ–û–°–¢–ò–í–´–ô, –Æ–†–û–î–ò–í–´–ô" },
            { suffix: "-–õ–ò–í-, -–ß–ò–í-", type: "–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ", rule: "–°—É—Ñ—Ñ–∏–∫—Å—ã -–õ–ò–í-, -–ß–ò–í- –≤—Å–µ–≥–¥–∞ –ø–∏—à—É—Ç—Å—è —Å –±—É–∫–≤–æ–π –ò.", exceptions: "–£ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö -–õ–ï–í-, -–ß–ï–í- –Ω–µ –±—ã–≤–∞–µ—Ç" },
            { suffix: "-–ò–°–¢-", type: "–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ", rule: "–°—É—Ñ—Ñ–∏–∫—Å -–ò–°–¢- –≤—Å–µ–≥–¥–∞ –ø–∏—à–µ—Ç—Å—è —Å –±—É–∫–≤–æ–π –ò.", exceptions: "–£ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö -–ï–°–¢- –Ω–µ –±—ã–≤–∞–µ—Ç" },
            { suffix: "-–ß–ê–¢-", type: "–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ", rule: "–°—É—Ñ—Ñ–∏–∫—Å -–ß–ê–¢- –≤—Å–µ–≥–¥–∞ –ø–∏—à–µ—Ç—Å—è —Å –±—É–∫–≤–æ–π –ê.", exceptions: "–î–û–©–ê–¢–´–ô (–æ—Ç –î–û–°–ö–ê —Å –ø–æ–º–æ—â—å—é -–ê–¢-)" },
            { suffix: "-–ï–í–ê–¢-, -–û–í–ê–¢-", type: "–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ", rule: "–°—É—Ñ—Ñ–∏–∫—Å—ã –ø–∏—à—É—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ –≤—Å–µ—Ö —Å–ª–æ–≤–∞—Ö.", exceptions: "–£ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö -–ò–í–ê–¢-, -–ê–í–êT- –Ω–µ –±—ã–≤–∞–µ—Ç" },
            { suffix: "-–ï–ù–¨–ö-, -–û–ù–¨–ö-", type: "–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ", rule: "–°—É—Ñ—Ñ–∏–∫—Å—ã –ø–∏—à—É—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ –≤—Å–µ—Ö —Å–ª–æ–≤–∞—Ö.", exceptions: "–£ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö -–ò–ù–¨–ö-, -–ê–ù–¨–ö- –Ω–µ –±—ã–≤–∞–µ—Ç" },
            { suffix: "-–ï–ù–°–ö-, -–ò–ù–°–ö-", type: "–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ", rule: "-–ò–ù–°–ö- –ø–∏—à–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Ç –æ—Å–Ω–æ–≤ –Ω–∞ -–ò–ù, –∞ —Ç–∞–∫–∂–µ -–ò(–´), -–ê(–Ø). -–ï–ù–°–ö- –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.", exceptions: "–ü–ï–ù–ó–ï–ù–°–ö–ò–ô, –ü–†–ï–°–ù–ï–ù–°–ö–ò–ô, –ö–û–õ–û–ú–ï–ù–°–ö–ò–ô" },
            { suffix: "-–ö-, -–°–ö-", type: "–ü—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ", rule: "–ï—Å–ª–∏ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ –∏–º–µ–µ—Ç –∫—Ä–∞—Ç–∫—É—é —Ñ–æ—Ä–º—É –∏–ª–∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –æ—Ç —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å –ö, –¶, –ß, –ø–∏—à–µ—Ç—Å—è -–ö-. –ò–Ω–∞—á–µ -–°–ö-.", exceptions: "–§–†–ê–ù–¶–£–ó–°–ö–ò–ô (–Ω–µ –∏–º–µ–µ—Ç –∫—Ä–∞—Ç–∫–æ–π —Ñ–æ—Ä–º—ã –∏ –Ω–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –æ—Ç –ö, –¶, –ß)" },
            
            // –ì–ª–∞–≥–æ–ª—ã
            { suffix: "-–ò–í–ê-, (-–´–í–ê-)", type: "–ì–ª–∞–≥–æ–ª—ã", rule: "–£ –≥–ª–∞–≥–æ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª—å–Ω–æ–π —Ñ–æ—Ä–º–µ –∏ —Ñ–æ—Ä–º–µ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–∏—à–µ—Ç—Å—è -–ò–í–ê-, (-–´–í–ê-), –µ—Å–ª–∏ –≤ —Ñ–æ—Ä–º–µ 1 –ª–∏—Ü–∞ (–Ø) –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –∏–ª–∏ –±—É–¥—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≥–ª–∞–≥–æ–ª –æ–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ -–ò–í–ê–Æ, (-–´–í–ê–Æ).", exceptions: "" },
            { suffix: "-–ï–í–ê-, (-–û–í–ê-)", type: "–ì–ª–∞–≥–æ–ª—ã", rule: "–ü–∏—à–µ—Ç—Å—è -–ï–í–ê-, (-–û–í–ê-), –µ—Å–ª–∏ –≤ —Ñ–æ—Ä–º–µ 1 –ª–∏—Ü–∞ (–Ø) –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –∏–ª–∏ –±—É–¥—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≥–ª–∞–≥–æ–ª –æ–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ -–£–Æ, (-–Æ–Æ).", exceptions: "" },
            { suffix: "–ò, –ï –ø–µ—Ä–µ–¥ -–í–ê-", type: "–ì–ª–∞–≥–æ–ª—ã", rule: "–û—Ç –≥–ª–∞–≥–æ–ª–æ–≤ —Å —Å—É—Ñ—Ñ–∏–∫—Å–∞–º–∏ -–ò–í–ê-, (-–´–í–ê-), -–ï–í–ê-, (-–û–í–ê-) —Å–ª–µ–¥—É–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å –≥–ª–∞–≥–æ–ª—ã —Å–æ –≤—Å–µ–≥–¥–∞ —É–¥–∞—Ä–Ω—ã–º —Å—É—Ñ—Ñ–∏–∫—Å–æ–º -–í–ê-. –ü–µ—Ä–µ–¥ —É–¥–∞—Ä–Ω—ã–º -–í–ê- –ø–∏—à–µ—Ç—Å—è —Ç–∞ –∂–µ –≥–ª–∞—Å–Ω–∞—è –±—É–∫–≤–∞, —á—Ç–æ –∏ –≤ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Ñ–æ—Ä–º–µ, –µ—Å–ª–∏ –≤ –Ω–µ–π –æ—Ç–±—Ä–æ—Å–∏—Ç—å -–í–ê-.", exceptions: "" },
            
            // –°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ
            { suffix: "-–ï–¶-, -–ò–¶-", type: "–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ", rule: "–í —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –º—É–∂—Å–∫–æ–≥–æ —Ä–æ–¥–∞ –ø–∏—à–µ—Ç—Å—è -–ï–¶-. –í —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∂–µ–Ω—Å–∫–æ–≥–æ —Ä–æ–¥–∞ –ø–∏—à–µ—Ç—Å—è -–ò–¶-. –í —Å—Ä–µ–¥–Ω–µ–º —Ä–æ–¥–µ: –ê) -–ï–¶-, –µ—Å–ª–∏ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ; –ë) -–ò–¶-, –µ—Å–ª–∏ —É–¥–∞—Ä–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–µ –Ω–∞ –æ–∫–æ–Ω—á–∞–Ω–∏–µ.", exceptions: "" },
            { suffix: "-–ò–ù–ö-, -–ï–ù–ö-", type: "–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ", rule: "-–ò–ù–ö- –ø–∏—à–µ—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç —Å–ª–æ–≤, –æ–∫–∞–Ω—á–∏–≤–∞—é—â–∏—Ö—Å—è –Ω–∞ -–ò–ù(–ê). -–ï–ù–ö- –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.", exceptions: "" },
            { suffix: "-–ò–ó–ù-, -–ò–ù-", type: "–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ", rule: "–°—É—Ñ—Ñ–∏–∫—Å—ã -–ò–ó–ù-, -–ò–ù- –≤—Å–µ–≥–¥–∞ –ø–∏—à—É—Ç—Å—è —Å –±—É–∫–≤–æ–π –ò.", exceptions: "–£ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–µ –±—ã–≤–∞–µ—Ç -–ï–ó–ù-, -–ï–ù-" },
            { suffix: "-–ò–ß–ö-, -–ï–ß–ö-", type: "–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ", rule: "-–ò–ß–ö- –ø–∏—à–µ—Ç—Å—è –≤ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç —Å–ª–æ–≤, –æ–∫–∞–Ω—á–∏–≤–∞—é—â–∏—Ö—Å—è –Ω–∞ -–ò–¶(–ê). -–ï–ß–ö- –≤ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.", exceptions: "" },
            { suffix: "-–ò–ö-, -–ï–ö-", type: "–°—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ", rule: "-–ò–ö- –ø–∏—à–µ—Ç—Å—è, –µ—Å–ª–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ª–æ–≤–∞ –≥–ª–∞—Å–Ω–∞—è –±—É–∫–≤–∞ –Ω–µ –≤—ã–ø–∞–¥–∞–µ—Ç. -–ï–ö- –ø–∏—à–µ—Ç—Å—è, –µ—Å–ª–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ª–æ–≤–∞ –≥–ª–∞—Å–Ω–∞—è –±—É–∫–≤–∞ –≤—ã–ø–∞–¥–∞–µ—Ç.", exceptions: "" },
            
            // –ù–∞—Ä–µ—á–∏—è
            { suffix: "-–ê-", type: "–ù–∞—Ä–µ—á–∏—è", rule: "–í –Ω–∞—Ä–µ—á–∏—è—Ö —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–∞–º–∏ –ò–ó-, –î–û-, –°- –ø–∏—à–µ—Ç—Å—è —Å—É—Ñ—Ñ–∏–∫—Å -–ê-.", exceptions: "" },
            { suffix: "-–û-", type: "–ù–∞—Ä–µ—á–∏—è", rule: "–í –Ω–∞—Ä–µ—á–∏—è—Ö —Å –ø—Ä–∏—Å—Ç–∞–≤–∫–∞–º–∏ –í-, –ù–ê-, –ó–ê- –ø–∏—à–µ—Ç—Å—è —Å—É—Ñ—Ñ–∏–∫—Å -–û-.", exceptions: "" },
            
            // –û, –Å –ø–æ—Å–ª–µ —à–∏–ø—è—â–∏—Ö
            { suffix: "–ë—É–∫–≤–∞ –Å", type: "–ü–æ—Å–ª–µ —à–∏–ø—è—â–∏—Ö", rule: "1) –≤ –≥–ª–∞–≥–æ–ª—å–Ω–æ–º —Å—É—Ñ—Ñ–∏–∫—Å–µ -–Å–í–´–í–ê-; 2) –≤ –æ—Ç–≥–ª–∞–≥–æ–ª—å–Ω—ã—Ö —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö -–Å–í–ö-; 3) –≤ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö -–Å–†-; 4) –≤ —Å—Ç—Ä–∞–¥–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏—á–∞—Å—Ç–∏—è—Ö -–Å–ù–ù-, -–Å–ù-; 5) –≤ –æ—Ç–≥–ª–∞–≥–æ–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö -–Å–ù-; 6) –≤ —Å–ª–æ–≤–∞—Ö –ö–û–ü–ß–Å–ù–û–°–¢–ò, –¢–£–®–Å–ù–ö–ê", exceptions: "–ï–©–Å" },
            { suffix: "–ë—É–∫–≤–∞ –û", type: "–ü–æ—Å–ª–µ —à–∏–ø—è—â–∏—Ö", rule: "–ü–æ—Å–ª–µ —à–∏–ø—è—â–∏—Ö –ø–æ–¥ —É–¥–∞—Ä–µ–Ω–∏–µ–º –≤ —Å—É—Ñ—Ñ–∏–∫—Å–∞—Ö: 1) —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö -–û–ö-; 2) —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö -–û–ù–û–ö-; 3) —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö -–û–ù–ö-; 4) –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö -–û–í-; 5) –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö -–û–ù-; 6) –Ω–∞—Ä–µ—á–∏–π (–°–í–ï–ñ–û, –ì–û–†–Ø–ß–û, –û–ë–©–û)", exceptions: "" }
        ];

        class FlashcardApp {
            constructor() {
                this.rules = rulesData.map((rule, index) => ({
                    ...rule,
                    id: index,
                    group: 'new' // new, learning, learned
                }));
                
                this.currentIndex = 0;
                this.isFlipped = false;
                
                this.loadProgress();
                this.render();
                this.attachEventListeners();
            }

            loadProgress() {
                const saved = localStorage.getItem('suffixProgress');
                if (saved) {
                    const progress = JSON.parse(saved);
                    this.rules = this.rules.map(rule => {
                        const savedRule = progress.find(r => r.id === rule.id);
                        return savedRule ? { ...rule, group: savedRule.group } : rule;
                    });
                }
            }

            saveProgress() {
                const progress = this.rules.map(r => ({ id: r.id, group: r.group }));
                localStorage.setItem('suffixProgress', JSON.stringify(progress));
            }

            getCurrentGroup() {
                if (this.rules.filter(r => r.group === 'new').length > 0) return 'new';
                if (this.rules.filter(r => r.group === 'learning').length > 0) return 'learning';
                if (this.rules.filter(r => r.group === 'learned').length > 0) return 'learned';
                return 'completed';
            }

            getCurrentCards() {
                const group = this.getCurrentGroup();
                if (group === 'completed') return [];
                return this.rules.filter(r => r.group === group);
            }

            updateProgress() {
                const newCount = this.rules.filter(r => r.group === 'new').length;
                const learningCount = this.rules.filter(r => r.group === 'learning').length;
                const learnedCount = this.rules.filter(r => r.group === 'learned').length;

                document.getElementById('newCount').textContent = newCount;
                document.getElementById('learningCount').textContent = learningCount;
                document.getElementById('learnedCount').textContent = learnedCount;

                const groupNames = {
                    'new': '–ò–∑—É—á–∞–µ–º –Ω–µ–∏–∑—É—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞',
                    'learning': '–ò–∑—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ',
                    'learned': '–ü–æ–≤—Ç–æ—Ä—è–µ–º –∏–∑—É—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞',
                    'completed': '–í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑—É—á–µ–Ω—ã!'
                };

                document.getElementById('currentGroup').textContent = groupNames[this.getCurrentGroup()];
            }

            render() {
                this.updateProgress();
                const cardArea = document.getElementById('cardArea');
                const currentCards = this.getCurrentCards();

                if (currentCards.length === 0) {
                    cardArea.innerHTML = `
                        <div class="completion-screen">
                            <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è—é!</h2>
                            <p>–¢—ã –∏–∑—É—á–∏–ª –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤!</p>
                            <button class="btn btn-reset" onclick="app.resetProgress()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                        </div>
                    `;
                    return;
                }

                if (this.currentIndex >= currentCards.length) {
                    this.currentIndex = 0;
                }

                const currentRule = currentCards[this.currentIndex];
                this.isFlipped = false;

                cardArea.innerHTML = `
                    <div class="card-container">
                        <div class="card" id="card">
                            <div class="card-face card-front">
                                <div class="card-type">${currentRule.type}</div>
                                <div class="card-suffix">${currentRule.suffix}</div>
                                <div class="flip-hint">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–∞–≤–∏–ª–æ</div>
                            </div>
                            <div class="card-face card-back">
                                <div class="card-rule">${currentRule.rule}</div>
                                ${currentRule.exceptions ? `
                                    <div class="card-exceptions">
                                        <strong>–ò—Å–∫–ª—é—á–µ–Ω–∏—è:</strong> ${currentRule.exceptions}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="controls">
                        <button class="btn btn-wrong" id="btnWrong">
                            ‚Üê –ù–µ –ø–æ–º–Ω—é
                        </button>
                        <button class="btn btn-correct" id="btnCorrect">
                            –ü–æ–º–Ω—é ‚Üí
                        </button>
                    </div>
                `;

                this.attachCardListeners();
            }

            attachCardListeners() {
                const card = document.getElementById('card');
                const btnWrong = document.getElementById('btnWrong');
                const btnCorrect = document.getElementById('btnCorrect');

                card.addEventListener('click', () => this.flipCard());
                btnWrong.addEventListener('click', () => this.markWrong());
                btnCorrect.addEventListener('click', () => this.markCorrect());
            }

            attachEventListeners() {
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        this.flipCard();
                    } else if (e.code === 'ArrowLeft') {
                        this.markWrong();
                    } else if (e.code === 'ArrowRight') {
                        this.markCorrect();
                    } else if (e.code === 'KeyR') {
                        if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')) {
                            this.resetProgress();
                        }
                    }
                });
            }

            flipCard() {
                const card = document.getElementById('card');
                if (card) {
                    this.isFlipped = !this.isFlipped;
                    card.classList.toggle('flipped');
                }
            }

            markWrong() {
                if (!this.isFlipped) return;
                
                const currentCards = this.getCurrentCards();
                const currentRule = currentCards[this.currentIndex];
                
                // –û—Å—Ç–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –≥—Ä—É–ø–ø–µ (–Ω–µ –º–µ–Ω—è–µ—Ç—Å—è)
                
                this.currentIndex++;
                this.saveProgress();
                this.render();
            }

            markCorrect() {
                if (!this.isFlipped) return;
                
                const currentCards = this.getCurrentCards();
                const currentRule = currentCards[this.currentIndex];
                const ruleInMain = this.rules.find(r => r.id === currentRule.id);
                
                // –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Å–ª–µ–¥—É—é—â—É—é –≥—Ä—É–ø–ø—É
                if (ruleInMain.group === 'new') {
                    ruleInMain.group = 'learning';
                } else if (ruleInMain.group === 'learning') {
                    ruleInMain.group = 'learned';
                }
                
                this.currentIndex++;
                this.saveProgress();
                this.render();
            }

            resetProgress() {
                if (confirm('–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')) {
                    localStorage.removeItem('suffixProgress');
                    this.rules.forEach(rule => rule.group = 'new');
                    this.currentIndex = 0;
                    this.render();
                }
            }
        }

        const app = new FlashcardApp();
    </script>
</body>
</html>
